{%TEMPLATE->struct/head%}
{%TEMPLATE->struct/menu%}

<h2>User ([[htmlentities([[user.getUsername()]], ENT_QUOTES, "UTF-8")]])</h2>

{%TEMPLATE->struct/messages%}

<div class="card">
  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <tbody>
        <tr>
          <th style="width: 220px;">User ID</th>
          <td>[[user.getId()]]</td>
        </tr>

        <tr>
          <th>Username</th>
          <td>[[htmlentities([[user.getUsername()]], ENT_QUOTES, "UTF-8")]]</td>
        </tr>

        <tr>
          <th>Email</th>
          <td>[[user.getEmail()]]</td>
        </tr>

        <tr>
          <th>Creation date</th>
          <td>[[date([[config.getVal(DConfig::TIME_FORMAT)]], [[user.getRegisteredSince()]])]]</td>
        </tr>

        <tr>
          <th>Last login</th>
          <td>[[date([[config.getVal(DConfig::TIME_FORMAT)]], [[user.getLastLoginDate()]])]]</td>
        </tr>

        <tr>
          <th>Member of groups</th>
          <td>
            {{FOREACH group;[[accessGroups]]}}
              <a href="groups.php?id=[[group.getId()]]">[[group.getGroupName()]]</a><br>
            {{ENDFOREACH}}
            {{IF [[sizeof([[accessGroups]])]] == 0}}
              <span class="text-muted">---</span>
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <th>Enable/Disable user</th>
          <td>
            {{IF [[user.getIsValid()]] == 1}}
              <div class="mb-2">
                <span class="badge badge-success">Enabled</span>
              </div>
              <form class="form-inline" action="users.php?id=[[user.getId()]]" method="post"
                    onsubmit="return confirm('Disable this user?');">
                <input type="hidden" name="action" value="[[$DUserAction::DISABLE_USER]]">
                <input type="hidden" name="user" value="[[user.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <button type="submit" class="btn btn-warning">Disable</button>
              </form>
            {{ELSE}}
              <div class="mb-2">
                <span class="badge badge-secondary">Disabled</span>
              </div>
              <form class="form-inline" action="users.php?id=[[user.getId()]]" method="post"
                    onsubmit="return confirm('Enable this user?');">
                <input type="hidden" name="action" value="[[$DUserAction::ENABLE_USER]]">
                <input type="hidden" name="user" value="[[user.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <button type="submit" class="btn btn-success">Enable</button>
              </form>
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <th>Set userâ€™s right group</th>
          <td>
            <form class="form-inline flex-wrap" action="users.php?id=[[user.getId()]]" method="post">
              <input type="hidden" name="action" value="[[$DUserAction::SET_RIGHTS]]">
              <input type="hidden" name="user" value="[[user.getId()]]">
              <input type="hidden" name="csrf" value="[[csrf]]">

              <select name="group" class="form-control mr-2 my-1" title="AccessLevel">
                {{FOREACH group;[[groups]]}}
                  <option value="[[group.getId()]]"{{IF [[group.getId()]] == [[user.getRightGroupId()]]}} selected{{ENDIF}}>
                    [[group.getGroupName()]]
                  </option>
                {{ENDFOREACH}}
              </select>

              <button type="submit"
                      class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}} my-1"
                      data-toggle="tooltip" data-placement="top" title="Save">
                <i class="fas fa-save" aria-hidden="true"></i>
              </button>
            </form>
          </td>
        </tr>

        <tr>
          <th>Set password</th>
          <td>
            <form class="form-inline flex-wrap" action="users.php?id=[[user.getId()]]" method="post"
                  onsubmit="return confirm('Set a new password for this user?');">
              <input type="hidden" name="action" value="[[$DUserAction::SET_PASSWORD]]">
              <input type="hidden" name="user" value="[[user.getId()]]">
              <input type="hidden" name="csrf" value="[[csrf]]">

              <input type="password" name="pass" class="form-control mr-2 my-1" title="Password" placeholder="New password">

              <button type="submit"
                      class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}} my-1"
                      data-toggle="tooltip" data-placement="top" title="Save">
                <i class="fas fa-save" aria-hidden="true"></i>
              </button>
            </form>
          </td>
        </tr>

        <tr>
          <th>Delete user</th>
          <td>
            <div class="alert alert-warning mb-2">
              Deleting a user cannot be undone.
            </div>
            <form class="form-inline" action="users.php?id=[[user.getId()]]" method="post"
                  onsubmit="if(!confirm('Do you really want to delete this user? This cannot be undone!')){return false;}">
              <input type="hidden" name="action" value="[[$DUserAction::DELETE_USER]]">
              <input type="hidden" name="user" value="[[user.getId()]]">
              <input type="hidden" name="csrf" value="[[csrf]]">
              <button type="submit" class="btn btn-danger" data-toggle="tooltip" data-placement="top" title="Delete">
                <i class="fas fa-trash" aria-hidden="true"></i>
              </button>
            </form>
          </td>
        </tr>

      </tbody>
    </table>
  </div>
</div>

{%TEMPLATE->struct/foot%}
