{%TEMPLATE->struct/head%}
{%TEMPLATE->struct/menu%}

<h2>Preconfigured task details</h2>
{%TEMPLATE->struct/messages%}

<div class="card">
  <div class="table-responsive">
    <table class="table table-bordered table-sm align-middle mb-0">
      <tbody>
        <tr>
          <th style="width: 220px;">Property</th>
          <th>Value</th>
        </tr>

        <tr>
          <td>ID:</td>
          <td>
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
              <code>[[pretask.getId()]]</code>

              {{IF [[accessControl.hasPermission([[$DAccessControl::CREATE_PRETASK_ACCESS]])]]}}
                <form class="m-0"
                      action="pretasks.php"
                      method="POST"
                      onSubmit="if (!confirm('Really delete preconfigured task [[pretask.getId()]]?') || ({{IF [[isUsed]]}}true{{ELSE}}false{{ENDIF}} && !confirm('This task is used in a Supertask, are you sure you really want to delete it?'))) return false;">
                  <input type="hidden" name="action" value="[[$DPretaskAction::DELETE_PRETASK]]">
                  <input type="hidden" name="csrf" value="[[csrf]]">
                  <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                  <button type="submit" class="btn btn-danger" data-toggle="tooltip" data-placement="top" title="Delete">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </form>
              {{ENDIF}}
            </div>
          </td>
        </tr>

        <tr>
          <td>Name:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::RENAME_PRETASK]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" class="form-control" name="name" value="[[pretask.getTaskName()]]" title="Name" style="min-width: 220px;">
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              [[pretask.getTaskName()]]
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Attack command:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::CREATE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0"
                    action="pretasks.php?id=[[pretask.getId()]]"
                    onsubmit="return confirm('Do you really want to change the attack command?')"
                    method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::CHANGE_ATTACK]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text"
                       name="attackCmd"
                       class="form-control"
                       title="Attack Command"
                       value="[[htmlentities([[pretask.getAttackCmd()]], ENT_QUOTES, 'UTF-8')]]"
                       style="min-width: 280px; flex: 1 1 420px;">
                <button type="submit" class="btn btn-warning" data-toggle="tooltip" data-placement="top" title="Change">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              <pre class="mb-0">[[htmlentities([[pretask.getAttackCmd()]], ENT_QUOTES, "UTF-8")]]</pre>
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Chunk size:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::SET_TIME]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" class="form-control" name="chunktime" value="[[pretask.getChunkTime()]]" title="Chunk Time" style="width: 110px;">
                <span class="text-muted">seconds</span>
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              [[pretask.getChunkTime()]] seconds
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Color:</td>
          <td>
            <form class="d-flex flex-wrap align-items-center gap-2 m-0" id="taskcolor" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
              <input type="hidden" name="action" value="[[$DPretaskAction::SET_COLOR]]">
              <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
              <input type="hidden" name="csrf" value="[[csrf]]">
              <div class="input-group" style="width: 170px;">
                <span class="input-group-text">#</span>
                <input type="text" class="form-control color {required:false}" name="color" value="[[pretask.getColor()]]" title="Color">
              </div>
              {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              {{ENDIF}}
            </form>
          </td>
        </tr>

        <tr>
          <td>Benchmark Type:</td>
          <td>
            {{IF [[pretask.getUseNewBench()]] == 0}}Runtime Benchmark{{ELSE}}Speed Test{{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Status timer:</td>
          <td>[[pretask.getStatusTimer()]] seconds</td>
        </tr>

        <tr>
          <td>Priority:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::SET_PRIORITY]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" class="form-control" name="priority" value="[[pretask.getPriority()]]" title="Priority" style="width: 110px;">
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              [[pretask.getPriority()]]
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Max agents:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::SET_MAX_AGENTS]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" class="form-control" name="maxAgents" value="[[pretask.getMaxAgents()]]" title="Max agents" style="width: 110px;">
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              [[pretask.getMaxAgents()]]
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>CPU only task:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::SET_CPU_TASK]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <select name="isCpu" class="form-control" title="CPU" style="width: 160px;">
                  <option value="0"{{IF [[pretask.getIsCpuTask()]] == 0}} selected{{ENDIF}}>No</option>
                  <option value="1"{{IF [[pretask.getIsCpuTask()]] == 1}} selected{{ENDIF}}>Yes</option>
                </select>
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              {{IF [[pretask.getIsCpuTask()]] == 1}}Yes{{ELSE}}No{{ENDIF}}
            {{ENDIF}}
          </td>
        </tr>

        <tr>
          <td>Small task:</td>
          <td>
            {{IF [[accessControl.hasPermission([[$DAccessControl::MANAGE_PRETASK_ACCESS]])]]}}
              <form class="d-flex flex-wrap align-items-center gap-2 m-0" action="pretasks.php?id=[[pretask.getId()]]" method="POST">
                <input type="hidden" name="action" value="[[$DPretaskAction::SET_SMALL_TASK]]">
                <input type="hidden" name="pretaskId" value="[[pretask.getId()]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <select name="isSmall" class="form-control" title="Small" style="width: 160px;">
                  <option value="0"{{IF [[pretask.getIsSmall()]] == 0}} selected{{ENDIF}}>No</option>
                  <option value="1"{{IF [[pretask.getIsSmall()]] == 1}} selected{{ENDIF}}>Yes</option>
                </select>
                <button type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" data-toggle="tooltip" data-placement="top" title="Save">
                  <i class="fas fa-save" aria-hidden="true"></i>
                </button>
              </form>
            {{ELSE}}
              {{IF [[pretask.getIsSmall()]] == 1}}Yes{{ELSE}}No{{ENDIF}}
            {{ENDIF}}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{{IF [[sizeof([[attachedFiles]])]] > 0}}
  <h3 class="mt-3">Attached files</h3>
  <div class="card">
    <div class="table-responsive">
      <table class="table table-bordered table-sm align-middle mb-0">
        <thead>
          <tr>
            <th style="width: 120px;">ID</th>
            <th>Filename</th>
            <th class="text-end" style="width: 160px;">Size</th>
          </tr>
        </thead>
        <tbody>
          {{FOREACH file;[[attachedFiles]]}}
            <tr>
              <td>[[file.getId()]]</td>
              <td>
                {{IF [[accessControl.hasPermission([[$DAccessControl::VIEW_FILE_ACCESS]])]]}}
                  <a href="files.php#[[file.getId()]]">[[file.getFilename()]]</a>
                {{ELSE}}
                  [[file.getFilename()]]
                {{ENDIF}}
                {{IF [[file.getIsSecret()]] == 1}}
                  <span class="fas fa-lock ms-1" aria-hidden="true"></span>
                {{ENDIF}}
              </td>
              <td class="num text-end" data-sort="[[file.getSize()]]">
                [[Util::nicenum([[file.getSize()]])]]B
              </td>
            </tr>
          {{ENDFOREACH}}
        </tbody>
      </table>
    </div>
  </div>
{{ENDIF}}

{%TEMPLATE->struct/foot%}
