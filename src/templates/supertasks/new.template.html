{%TEMPLATE->struct/head%}
{%TEMPLATE->struct/menu%}

<h2>Use Supertask</h2>
{%TEMPLATE->struct/messages%}

<form action="supertasks.php" method="POST">
  <input type="hidden" name="action" value="[[$DSupertaskAction::APPLY_SUPERTASK]]">
  <input type="hidden" name="supertask" value="[[orig]]">
  <input type="hidden" name="csrf" value="[[csrf]]">

  <div class="card">
    <div class="table-responsive">
      <table class="table table-bordered table-sm align-middle mb-0">
        <thead>
          <tr>
            <th style="width: 300px;">Property</th>
            <th>Value</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>
              Hashlist:<br>
              <span class="text-muted">(hashlist needs to be created before task)</span>
            </td>
            <td>
              <select class="form-control w-100" name="hashlist" title="Hashlist">
                {{FOREACH list;[[lists]]}}
                  <option value="[[list.getId()]]">[[list.getHashlistName()]]</option>
                {{ENDFOREACH}}
              </select>
            </td>
          </tr>

          <tr>
            <td>Binary type to run task:</td>
            <td>
              <div class="row g-2">
                <div class="col-12 col-md-6">
                  <select name="crackerBinaryTypeId" id="crackerBinaryTypeId" class="form-control w-100" title="Cracker Binary">
                    {{FOREACH binary;[[binaries]]}}
                      <option value="[[binary.getId()]]">[[binary.getTypeName()]]</option>
                    {{ENDFOREACH}}
                  </select>
                </div>

                <div class="col-12 col-md-6">
                  <select name="crackerBinaryVersionId" id="crackerBinaryVersionId" class="form-control w-100" title="Binary Version">
                    <option value="0">&nbsp;</option>
                  </select>
                </div>
              </div>

              <script type="text/javascript">
                var versions = [];
                {{FOREACH version;[[versions]]}}
                  if ([[version.getCrackerBinaryTypeId()]] in versions) {
                    versions[[version.getCrackerBinaryTypeId()]].push(["[[version.getVersion()]]", [[version.getId()]]]);
                  } else {
                    versions[[version.getCrackerBinaryTypeId()]] = [["[[version.getVersion()]]", [[version.getId()]]]];
                  }
                {{ENDFOREACH}}

                function configureDropDownLists(ddl1, ddl2) {
                  ddl2.options.length = 0;
                  if (!ddl1.value || ddl1.value.length === 0) {
                    return;
                  }
                  if (!(ddl1.value in versions)) {
                    return;
                  }
                  for (var i = 0; i < versions[ddl1.value].length; i++) {
                    createOption(ddl2, versions[ddl1.value][i][0], versions[ddl1.value][i][1]);
                  }
                }

                function createOption(ddl, text, value) {
                  var opt = document.createElement('option');
                  opt.value = value;
                  opt.text = text;
                  ddl.options.add(opt);
                }

                configureDropDownLists(
                  document.getElementById('crackerBinaryTypeId'),
                  document.getElementById('crackerBinaryVersionId')
                );

                $("#crackerBinaryTypeId").change(function() {
                  configureDropDownLists(
                    document.getElementById('crackerBinaryTypeId'),
                    document.getElementById('crackerBinaryVersionId')
                  );
                });
              </script>
            </td>
          </tr>

          <tr>
            <td colspan="2">
              <input type="submit"
                     class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}"
                     value="Create tasks from supertask">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</form>

{%TEMPLATE->struct/foot%}
