{%TEMPLATE->struct/head%}
{%TEMPLATE->struct/menu%}
<h2>My Account ([[htmlentities([[user.getUsername()]], ENT_QUOTES, "UTF-8")]])</h2>
{%TEMPLATE->struct/messages%}

<div class="card mb-3">
  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <tbody>
        <tr>
          <th style="width: 220px;">User type</th>
          <td>[[group.getGroupName()]]</td>
        </tr>

        <tr>
          <th>Register date</th>
          <td>[[date([[config.getVal(DConfig::TIME_FORMAT)]], [[user.getRegisteredSince()]])]]</td>
        </tr>

        <tr>
          <th>Email address</th>
          <td>
            <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
              <input type="hidden" name="action" value="[[$DAccountAction::SET_EMAIL]]">
              <input type="hidden" name="csrf" value="[[csrf]]">

              <input type="email" name="email" class="form-control" value="[[user.getEmail()]]" title="Email" style="max-width: 420px;">

              <button type="submit"
                class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}"
                data-bs-toggle="tooltip" data-bs-placement="top" title="Set">
                <i class="fas fa-save" aria-hidden="true"></i>
              </button>
            </form>
          </td>
        </tr>

        <tr>
          <th>Set session length</th>
          <td>
            <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
              <input type="hidden" name="action" value="[[$DAccountAction::UPDATE_LIFETIME]]">
              <input type="hidden" name="csrf" value="[[csrf]]">

              <input type="text" name="lifetime" class="form-control" value="[[user.getSessionLifetime()]]" title="Session Length" style="max-width: 220px;">
              <span class="text-muted">seconds</span>

              <button type="submit"
                class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}"
                data-bs-toggle="tooltip" data-bs-placement="top" title="Set">
                <i class="fas fa-save" aria-hidden="true"></i>
              </button>
            </form>
          </td>
        </tr>

        <tr>
          <th>Password</th>
          <td>
            <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
              <input type="hidden" name="action" value="[[$DAccountAction::CHANGE_PASSWORD]]">
              <input type="hidden" name="csrf" value="[[csrf]]">

              <input type="password" name="oldpass" class="form-control" placeholder="Old password here..." style="max-width: 260px;">
              <input type="password" name="newpass" class="form-control" placeholder="New password here..." style="max-width: 260px;">
              <input type="password" name="reppass" class="form-control" placeholder="Repeat password..." style="max-width: 260px;">

              <input type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" value="Change Password">
            </form>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card mb-3">
  <div class="table-responsive">
    <table class="table table-bordered align-middle mb-0">
      <tbody>
        <tr>
          <td colspan="2">
            <div class="alert alert-warning mb-0">
              <b>Disclaimer:</b> Administrators cannot reset your OTP auth information if your key is lost.
            </div>
          </td>
        </tr>

        {{IF ![[Util::isYubikeyEnabled()]]}}
          <tr>
            <th style="width: 220px;">Yubikey OTP</th>
            <td>
              Yubikey is currently not configured.<br>
              Please contact an admin as it needs to be enabled and set up on the server configuration.
            </td>
          </tr>
        {{ELSE}}
          <tr>
            <th>Enable/Disable Yubikey OTP</th>
            <td>
              {{IF [[user.getYubikey()]] == 1}}
                <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                  <span>Yubikey OTP currently enabled</span>
                  <input type="hidden" name="action" value="[[$DAccountAction::YUBIKEY_DISABLE]]">
                  <input type="hidden" name="csrf" value="[[csrf]]">
                  <input type="submit" class="btn btn-warning" value="Disable">
                </form>
              {{ELSE}}
                <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                  <span>Yubikey OTP is currently disabled</span>
                  <input type="hidden" name="action" value="[[$DAccountAction::YUBIKEY_ENABLE]]">
                  <input type="hidden" name="csrf" value="[[csrf]]">
                  <input type="submit" class="btn btn-success" value="Enable">
                </form>
              {{ENDIF}}
            </td>
          </tr>

          <tr>
            <th>OTP KEY 1:</th>
            <td>
              <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                <input type="hidden" name="action" value="[[$DAccountAction::SET_OTP1]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" name="otp1" class="form-control" value="[[user.getOtp1()]]" title="OTP Key" style="max-width: 520px;">
                <input type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" value="Update">
              </form>
            </td>
          </tr>

          <tr>
            <th>OTP KEY 2:</th>
            <td>
              <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                <input type="hidden" name="action" value="[[$DAccountAction::SET_OTP2]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" name="otp2" class="form-control" value="[[user.getOtp2()]]" title="OTP Key" style="max-width: 520px;">
                <input type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" value="Update">
              </form>
            </td>
          </tr>

          <tr>
            <th>OTP KEY 3:</th>
            <td>
              <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                <input type="hidden" name="action" value="[[$DAccountAction::SET_OTP3]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" name="otp3" class="form-control" value="[[user.getOtp3()]]" title="OTP Key" style="max-width: 520px;">
                <input type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" value="Update">
              </form>
            </td>
          </tr>

          <tr>
            <th>OTP KEY 4:</th>
            <td>
              <form class="d-flex flex-wrap gap-2 align-items-center" action="account.php" method="post">
                <input type="hidden" name="action" value="[[$DAccountAction::SET_OTP4]]">
                <input type="hidden" name="csrf" value="[[csrf]]">
                <input type="text" name="otp4" class="form-control" value="[[user.getOtp4()]]" title="OTP Key" style="max-width: 520px;">
                <input type="submit" class="btn {{IF [[toggledarkmode]] > 0}}btn-primary{{ELSE}}btn-light{{ENDIF}}" value="Update">
              </form>
            </td>
          </tr>
        {{ENDIF}}
      </tbody>
    </table>
  </div>
</div>

{{IF [[sizeof([[keys]])]] > 0}}
  <h3>API Access</h3>
  <div class="card">
    <div class="table-responsive">
      <table class="table table-bordered align-middle mb-0">
        <tbody>
          <tr>
            <th style="width: 220px;">Keys</th>
            <td>
              {{FOREACH key;[[keys]]}}
                [[key.getAccessKey()]]<br>
              {{ENDFOREACH}}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
{{ENDIF}}

{%TEMPLATE->struct/foot%}
