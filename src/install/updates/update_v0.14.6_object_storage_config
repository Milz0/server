<?php

use DBA\Config;
use DBA\ConfigSection;
use DBA\Factory;
use DBA\QueryFilter;

require_once(dirname(__FILE__) . "/../../inc/defines/config.php");

if (!isset($PRESENT["v0.14.6_object_storage_config"])) {
  $sectionId = 8;

  $section = Factory::getConfigSectionFactory()->get($sectionId);
  if ($section === null) {
    $section = new ConfigSection($sectionId, "Object Storage");
    Factory::getConfigSectionFactory()->save($section);
  }

  $defaults = [
    DConfig::OBJECT_STORAGE_ENABLE       => "0",
    DConfig::OBJECT_STORAGE_ENDPOINT     => "",
    DConfig::OBJECT_STORAGE_REGION       => "",
    DConfig::OBJECT_STORAGE_BUCKET       => "",
    DConfig::OBJECT_STORAGE_ACCESS_KEY   => "",
    DConfig::OBJECT_STORAGE_SECRET_KEY   => "",
    DConfig::OBJECT_STORAGE_PREFIX       => "",
    DConfig::OBJECT_STORAGE_PATH_STYLE   => "0",
    DConfig::OBJECT_STORAGE_VERIFY_SSL   => "1",
    DConfig::OBJECT_STORAGE_PRESIGN_TTL  => "60",
    DConfig::OBJECT_STORAGE_DEFAULT_SRC  => "local",
  ];

  foreach ($defaults as $item => $value) {
    $qF = new QueryFilter(Config::ITEM, $item, "=");
    $existing = Factory::getConfigFactory()->filter([Factory::FILTER => $qF], true);
    if ($existing === null) {
      Factory::getConfigFactory()->save(new Config(null, $sectionId, $item, $value));
    }
  }

  $EXECUTED["v0.14.6_object_storage_config"] = true;
}
